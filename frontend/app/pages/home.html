<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gover åŠŸèƒ½é¦–é¡µ</title>
  <link rel="stylesheet" href="/app/pages/shared.css" />
</head>
<body>
  <header class="shared-header">
    <div id="sharedNav"></div>
  </header>
  <main class="page-shell">
    <section class="page-card">
      <h1>æ¬¢è¿ä½¿ç”¨ Goverï¼ˆæ™®é€šç”¨æˆ·æ¨¡å¼ï¼‰</h1>
      <p class="soft-note">å…ˆå®Œæˆä¸‹é¢ 3 æ­¥ï¼Œå°±å¯ä»¥ä»æ‘„åƒå¤´ä¸€è·¯æ¨æµåˆ° B ç«™ã€‚</p>
      <div id="roleTip" class="role-tip"></div>

      <div id="quickSteps" class="stepper">
        <div id="stepLogin" class="stepper-item">
          <span>â‘  ç™»å½•è´¦å·</span>
          <span class="badge badge-neutral">æœªå®Œæˆ</span>
        </div>
        <div id="stepCamera" class="stepper-item">
          <span>â‘¡ æ·»åŠ æ‘„åƒå¤´</span>
          <span class="badge badge-neutral">æœªå®Œæˆ</span>
        </div>
        <div id="stepPush" class="stepper-item">
          <span>â‘¢ å¼€å§‹æ¨æµ</span>
          <span class="badge badge-neutral">æœªå®Œæˆ</span>
        </div>
      </div>
    </section>

    <section class="page-card">
      <h2>åŠŸèƒ½å¯¼èˆªï¼ˆæŒ‰ä¸šåŠ¡åˆ†åŒºï¼‰</h2>
      <div class="menu-grid">
        <a class="menu-card" href="/app/pages/login.html">
          <div class="menu-top">
            <h3><span class="menu-icon">ğŸ”</span> è´¦å·ç™»å½•</h3>
            <span id="badgeLogin" class="badge badge-neutral">æ£€æŸ¥ä¸­</span>
          </div>
          <p>æ‰«ç ç™»å½•ã€æŸ¥çœ‹çŠ¶æ€ã€è‡ªåŠ¨åˆ·æ–° Cookieã€‚</p>
        </a>
        <a class="menu-card" href="/app/pages/cameras.html">
          <div class="menu-top">
            <h3><span class="menu-icon">ğŸ“·</span> æ‘„åƒå¤´ç®¡ç†</h3>
            <span id="badgeCameraCount" class="badge badge-info">0 å°</span>
          </div>
          <p>ç»Ÿä¸€ç®¡ç† RTSP/MJPEG/ONVIF/USBï¼Œæ”¯æŒä¿å­˜å’Œé¢„è§ˆã€‚</p>
        </a>
        <a class="menu-card" href="/app/pages/gb28181.html">
          <h3><span class="menu-icon">ğŸ›°ï¸</span> GB28181 å¹³å°</h3>
          <p>ç®¡ç† SIP å¹³å°é…ç½®ã€è®¾å¤‡æ³¨å†Œã€ç›®å½•æŸ¥è¯¢ä¸ä¼šè¯æ§åˆ¶ã€‚</p>
        </a>
        <a class="menu-card" href="/app/pages/push.html">
          <div class="menu-top">
            <h3><span class="menu-icon">ğŸ“¡</span> æ¨æµæ§åˆ¶</h3>
            <span id="badgePush" class="badge badge-neutral">æ£€æŸ¥ä¸­</span>
          </div>
          <p>å¥—ç”¨æ‘„åƒå¤´ã€è°ƒæ•´æ¨æµå‚æ•°ã€æ§åˆ¶å¼€å§‹/åœæ­¢ã€‚</p>
        </a>
        <a class="menu-card" href="/app/pages/room.html">
          <h3><span class="menu-icon">ğŸ </span> ç›´æ’­é—´ç®¡ç†</h3>
          <p>ç»´æŠ¤æˆ¿é—´å·ã€åˆ†åŒºã€æ ‡é¢˜å’Œå…¬å‘Šã€‚</p>
        </a>
        <a class="menu-card" href="/app/pages/material.html">
          <h3><span class="menu-icon">ğŸ¬</span> ç´ æç®¡ç†</h3>
          <p>ä¸Šä¼ è§†é¢‘/éŸ³é¢‘ç´ æï¼Œä¾›æ¨æµä¸æ‹¼å±å¤ç”¨ã€‚</p>
        </a>
        <a class="menu-card" href="/app/pages/monitor.html">
          <h3><span class="menu-icon">ğŸ””</span> ç›‘æ§ä¸é€šçŸ¥</h3>
          <p>é‚®ä»¶é…ç½®ã€å‘Šè­¦æµ‹è¯•ã€è¿è¡Œæ—¥å¿—æŸ¥çœ‹ã€‚</p>
        </a>
        <a class="menu-card" href="/app/index.html">
          <h3><span class="menu-icon">ğŸ§ª</span> é«˜çº§æ§åˆ¶å°</h3>
          <p>è¿›é˜¶åŠŸèƒ½å…¥å£ï¼ˆé›†æˆã€ç»Ÿè®¡ã€ç»´æŠ¤ç­‰ï¼‰ã€‚</p>
        </a>
      </div>
      <pre id="homeBox">{}</pre>
    </section>
  </main>

  <script src="/app/pages/shared.js"></script>
  <script>
    const { initPage, requestJSON, showJSON, statusBadge, createPoller } = window.GoverShared;
    initPage({ active: "home" });

    function setBadge(id, text, type) {
      const el = document.getElementById(id);
      if (!el) return;
      el.outerHTML = statusBadge(text, type).replace("<span", `<span id="${id}"`);
    }

    function setStep(id, done, label) {
      const el = document.getElementById(id);
      if (!el) return;
      el.classList.remove("active", "done");
      if (done) {
        el.classList.add("done");
      } else {
        el.classList.add("active");
      }
      const badge = el.querySelector(".badge");
      if (!badge) return;
      badge.className = `badge ${done ? "badge-success" : "badge-neutral"}`;
      badge.textContent = done ? "âœ“ å·²å®Œæˆ" : label || "æœªå®Œæˆ";
    }

    async function refreshHomeStatus() {
      const [accountResp, pushResp, cameraResp] = await Promise.all([
        requestJSON("/api/v1/account/status"),
        requestJSON("/api/v1/push/status"),
        requestJSON("/api/v1/cameras?page=1&limit=1"),
      ]);

      const accountStatus = Number(((accountResp || {}).data || {}).status || 0);
      const loggedIn = accountStatus === 3;
      setBadge("badgeLogin", loggedIn ? "å·²ç™»å½•" : "æœªç™»å½•", loggedIn ? "success" : "danger");

      const pushStatus = Number(((pushResp || {}).data || {}).status || 0);
      let pushText = "å·²åœæ­¢";
      let pushType = "neutral";
      if (pushStatus === 3) {
        pushText = "è¿è¡Œä¸­";
        pushType = "success";
      } else if (pushStatus === 1) {
        pushText = "å¯åŠ¨ä¸­";
        pushType = "warning";
      } else if (pushStatus === 4) {
        pushText = "é‡è¯•ä¸­";
        pushType = "warning";
      }
      setBadge("badgePush", pushText, pushType);

      const cameraCount = Number((((cameraResp || {}).data || {}).dataCount) || 0);
      setBadge("badgeCameraCount", `${cameraCount} å°`, cameraCount > 0 ? "info" : "neutral");

      setStep("stepLogin", loggedIn, "æœªå®Œæˆ");
      setStep("stepCamera", cameraCount > 0, cameraCount > 0 ? "å·²å®Œæˆ" : "å¾…æ·»åŠ ");
      setStep("stepPush", pushStatus === 3, pushStatus === 3 ? "å·²å¼€æ’­" : "å¾…å¼€æ’­");

      showJSON("homeBox", {
        code: 0,
        message: "home status updated",
        data: {
          accountStatus,
          cameraCount,
          pushStatus,
        },
      });
    }

    const poller = createPoller(refreshHomeStatus, 5000);
    poller.start();
  </script>
</body>
</html>
